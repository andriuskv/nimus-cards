"use strict";(globalThis.webpackChunknimus_cards=globalThis.webpackChunknimus_cards||[]).push([[101],{997:(e,s,t)=>{t.d(s,{Z:()=>c});var n=t(294),a=t(893);const c=function({className:e,hide:s,children:t}){const c=(0,n.useCallback)((function({key:e}){"Escape"===e&&s()}),[]);return(0,n.useEffect)((()=>(window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)})),[]),(0,a.jsx)("div",{className:"modal-mask",onClick:function({target:e,currentTarget:t}){e===t&&s()},children:(0,a.jsx)("div",{className:"modal"+(e?` ${e}`:""),children:t})})}},101:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var n=t(294),a=t(250),c=t(620),r=t(446),i=t(255),d=t(461),o=t(997),l=t(291),u=t(893);function m({score:e,name:s,className:t}){const n={"--width":(e.total?e[s]/e.total*100:50)+"%"};return(0,u.jsx)("div",{className:`score-bar score-${s}-bar${t?` ${t}`:""}`,style:n,children:e[s]})}function h({score:e}){return(0,u.jsxs)("div",{className:"study-score",children:[(0,u.jsxs)("div",{className:"study-score-bar-name-container",children:[(0,u.jsx)("span",{children:"Wrong"}),(0,u.jsx)("span",{children:"Right"})]}),(0,u.jsxs)("div",{className:"study-score-bar-container",children:[(0,u.jsx)(m,{score:e,name:"wrong"}),(0,u.jsx)(m,{score:e,name:"right"})]})]})}var x=t(655);function y({score:e,deck:s,startTime:t,ids:n}){const a=!!(0,c.OZ)(s.cards).length,r=!!(0,c.Vb)(s.cards).length,i=s.cards.filter((e=>n.some((s=>e.id===s))));return(0,u.jsxs)("div",{className:"container max-width-limit",children:[(0,u.jsxs)("div",{className:"study-score-container",children:[(0,u.jsx)("h3",{className:"study-score-title",children:"Session Results"}),(0,u.jsxs)("div",{className:"study-score-stats",children:[(0,u.jsx)("span",{className:"study-score-accuracy-name",children:"Accuracy"}),(0,u.jsxs)("span",{className:"study-score-accuracy-value",children:[Math.round(e.right/e.total*100),"%"]}),(0,u.jsxs)("div",{className:"study-score-time",children:[(0,u.jsx)(d.Z,{name:"clock"}),(0,u.jsx)("span",{className:"study-score-time-value",children:(0,c.mr)(Math.floor((Date.now()-t)/1e3))})]})]}),(0,u.jsxs)("div",{className:"study-score-bars",children:[(0,u.jsx)(m,{score:e,name:"wrong"}),(0,u.jsx)(m,{score:e,name:"right"})]}),(0,u.jsxs)("div",{className:"study-score-btn-container",children:[a?(0,u.jsx)(x.rU,{to:{pathname:`/decks/${s.id}/learn`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Learn"}):(0,u.jsx)("span",{className:"btn btn-text study-score-btn disabled",children:"Learn"}),r?(0,u.jsx)(x.rU,{to:{pathname:`/decks/${s.id}/review`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Review"}):(0,u.jsx)("span",{className:"btn btn-text study-score-btn disabled",children:"Review"}),(0,u.jsx)(x.rU,{to:{pathname:`/decks/${s.id}/practice`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Practice"}),(0,u.jsx)(x.rU,{to:"/decks",className:"btn btn-text study-score-btn",children:"Close"})]})]}),(0,u.jsxs)("ul",{className:"study-session-stats",children:[(0,u.jsxs)("li",{className:"study-session-stats-item",children:[(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item",children:"Front"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-back-column",children:"Back"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-accuracy-column",children:"Accuracy"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-streak-column",children:"Streak"})]}),i.map(((e,s)=>{return(0,u.jsxs)("li",{className:"study-session-stats-item",children:[(0,u.jsx)("div",{className:"study-session-stats-column",children:e.front.attachment?.description||e.front.text}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-back-column",children:(t=e.back,"text"===t.type||"exact"===t.type?t.typeOptions.value:"multi"===t.type?t.typeOptions.options.find((({id:e})=>t.typeOptions.correctId===e)).value:void 0)}),(0,u.jsxs)("div",{className:"study-session-stats-column study-session-stats-accuracy-column",children:[(0,u.jsx)(m,{score:e.score,className:"small",name:"wrong"}),(0,u.jsx)(m,{score:e.score,className:"small",name:"right"})]}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-streak-column",children:e.score.streak})]},s);var t}))]})]})}function v({notes:e}){const[s,t]=(0,n.useState)(!1);return(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"study-notes-toggle-btn-container",children:(0,u.jsx)("button",{className:"btn btn-text",onClick:function(){t(!s)},children:"Notes"})}),s&&(0,u.jsx)("div",{className:"study-notes",children:e.value})]})}const b=function({id:e,attachmentId:s,side:t}){const[a,c]=(0,n.useState)(null),[r,i]=(0,n.useState)(!1),o=(0,n.useRef)(null),l=(0,n.useRef)(null);function m(){o.current.currentTime=0,o.current.play()}function h(){l.current.currentTime=0,l.current.play()}function x(){const{mediaType:e,src:s,attachmentId:t}=a;return"image"===e?(0,u.jsx)("button",{className:"btn btn-icon study-attachment-btn study-image-btn",onClick:y,children:(0,u.jsx)("img",{src:s,alt:"",className:"study-image"})}):"audio"===e?(0,u.jsxs)("button",{className:"btn study-attachment-btn study-audio-btn",onClick:m,children:[(0,u.jsx)(d.Z,{name:"volume",className:"study-audio-btn-icon"}),(0,u.jsx)("audio",{src:s,ref:o,autoPlay:!0},t)]}):"video"===e?(0,u.jsx)("button",{className:"btn btn-icon study-attachment-btn study-video-btn",onClick:h,children:(0,u.jsx)("video",{src:s,className:"study-video",crossOrigin:"anonymous",ref:l,autoPlay:!0},t)}):null}function y(){i(!r)}function v(){return(0,u.jsx)("div",{className:"study-front-text",children:t.text})}return(0,n.useEffect)((()=>{let e="",n="";if(t.attachment){const{blob:a,url:r,type:i}=t.attachment;n=a?"blob":"url",e=a?URL.createObjectURL(a):r,c({src:e,attachmentId:s,mediaType:i})}else c(null);return()=>{"blob"===n&&URL.revokeObjectURL(e)}}),[e,s]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"study-front-content",children:t.text&&a?(0,u.jsxs)(u.Fragment,{children:[x(),v()]}):t.text?v():a?x():null}),r&&(0,u.jsx)("div",{className:"study-expanded-image-mask",onClick:function(){i(!1)},children:(0,u.jsx)("img",{src:a.src,className:"study-expanded-image",alt:""})})]})};const j=function({card:e,selectOption:s,handleSubmit:t}){const{back:{type:n,typeOptions:a},revealed:c}=e;return"text"===n?(0,u.jsx)("div",{className:"study-card-text-content",children:a.value}):"exact"===n?function(){let s="input study-exact-input";return c&&(s+=e.isCorrect?" right":" wrong"),(0,u.jsxs)("form",{onSubmit:t,className:"study-exact",children:[(0,u.jsxs)("label",{children:[(0,u.jsxs)("div",{className:"study-exact-top",children:[(0,u.jsx)("div",{className:"study-exact-title",children:"Your Answer:"}),a.caseSensitive?(0,u.jsxs)("div",{className:"study-exact-notice",children:[(0,u.jsx)(d.Z,{name:"info",className:"study-exact-notice-icon"}),(0,u.jsx)("span",{children:"Answer is case sensitive"})]}):""]}),(0,u.jsx)("input",{type:"input",className:s,name:"answer",disabled:c})]}),(0,u.jsx)("button",{className:"btn study-exact-btn",disabled:c,children:"Check Answer"})]})}():"multi"===n?(0,u.jsx)("ul",{className:`study-multi study-multi-${a.layout}-type ${c?"revealed":""}`,children:a.options.map((({id:e,value:t},n)=>(0,u.jsx)("li",{children:(0,u.jsx)("button",{onClick:()=>s(e),className:`btn study-multi-item" study-multi-${a.layout}-type-item ${c&&a.correctId===e?"correct":""}`,children:t})},e+n)))}):null};const p=function({card:e,settings:s,selectOption:t,revealAnswer:n,nextStep:a,skipNextStepTimeout:c}){return(0,u.jsxs)("div",{className:"study-card",style:{"--text-base-size":`${s.textSize.value}rem`},children:[(0,u.jsx)(b,{id:e.id,attachmentId:e.attachmentId,side:e.front}),"text"!==e.back.type||e.revealed?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(j,{card:e,selectOption:t,handleSubmit:function(s){if(s.preventDefault(),s.persist(),e.revealed)return;const t=s.target.elements.answer.value;let n=!1;n=e.back.typeOptions.caseSensitive?t===e.back.typeOptions.value:t.toLowerCase()===e.back.typeOptions.value.toLowerCase(),a(n),setTimeout((()=>{s.target.reset()}),1600)}}),"text"===e.back.type&&e.revealed&&(e.finished||e.timerReveal?(0,u.jsx)("button",{className:"btn btn-invert study-card-text-btn",onClick:c,children:"Next"}):(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{className:"btn btn-negative study-card-text-btn",disabled:e.finished,onClick:()=>a(!1),children:"I Was Wrong"}),(0,u.jsx)("button",{className:"btn btn-positive study-card-text-btn",disabled:e.finished,onClick:()=>a(!0),children:"I Got It Right"})]}))]}):(0,u.jsx)("button",{className:"btn btn-invert study-card-text-btn",onClick:n,children:"Check"})]})};const f=function({revealed:e,initDuration:s,callback:t}){const[a,r]=(0,n.useState)(s),i=(0,n.useRef)(0);function d(e){e<1?t():i.current=setTimeout((()=>{const s=e-1;r(s),d(s)}),1e3)}return(0,n.useEffect)((()=>(d(a),()=>{clearTimeout(i.current)})),[]),(0,n.useEffect)((()=>{e&&clearTimeout(i.current)}),[e]),(0,u.jsx)("div",{className:"timer",children:(0,c.mr)(a)})};const k=function({mode:e}){const s=(0,a.TH)(),t=(0,a.s0)(),m=(0,a.UO)(),[x,b]=(0,n.useState)(null),j=(0,n.useRef)(0);function k(){"preview"!==e?(0,r.VC)(m.id).then((e=>{e?g(e):b({error:!0})})):s.state?.title?g(s.state):b({error:!0})}function g(s){let{cards:t}=s;if("learn"===e){if(t=(0,c.OZ)(t),!t.length)return void b({message:"You learned all available cards, come back later for a review."})}else if("review"===e&&(t=(0,c.Vb)(t),!t.length))return void b({message:"You have nothing to review at this moment, come back later."});const n=function(e,s){const t=(0,i.T)();return"preview"===s?{...t,randomize:{value:!1},cardCount:{value:0}}:!e.settings||e.settings.useGlobalSettings.value?t:{...e.settings,textSize:t.textSize}}(s,e);t=n.randomize.value?(0,c.Sy)(t):t;const a=t.slice(0,n.cardCount.value||t.length).map((e=>(e.score=e.score||{streak:0,right:0,wrong:0,total:0},e))),r="preview"===e?t[s.selectedCardIndex]:N(a);b({mode:e,deck:s,settings:n,sessionStartedAt:Date.now(),cardCount:a.length,cards:a,card:r,score:{right:0,wrong:0,total:0}}),(0,c.Dk)(s.title)}function N(e){const[s]=e;return"multi"===s.back.type&&(s.back.typeOptions.options=(0,c.Sy)(s.back.typeOptions.options)),{...s}}function w(e){const{score:s}=x;return e?s.right+=1:s.wrong+=1,s.total=s.right+s.wrong,s}function C(){I(!1,{timerReveal:!0})}function S(e,s){const t=x.deck.cards.find((s=>s.id===e));t.frozen||(function(e,s){const t=e.level||0;let n=t;s?n=t<8?t+1:8:(e.frozen=!0,n=1);const a=6*Math.pow(2,n-1)*n;e.level=n,e.nextReview=Date.now()+60*a*60*1e3}(t,s),function(e,s){s?(e.score.streak+=1,e.score.right+=1):(e.frozen=!0,e.score.streak=0,e.score.wrong+=1),e.score.total=e.score.right+e.score.wrong}(t,s))}function I(e,s={}){const t="preview"===x.mode?x.cards[x.deck.selectedCardIndex]:x.cards.shift(),n={...t,...s,isCorrect:e,revealed:!0,finished:!0};"learn"!==x.mode&&"review"!==x.mode||S(t.id,e),e?x.sessionCardIds=[...x.sessionCardIds||[],t.id]:"preview"!==x.mode&&(t.attachmentId=(0,c.zO)(),x.cards.push(t),x.cards=x.settings.randomize.value?(0,c.Sy)(x.cards):x.cards),b({...x,card:n,score:w(e)}),j.current=setTimeout("preview"===x.mode?O:T,1600)}function O(){const e=(x.deck.selectedCardIndex+1)%x.cards.length;x.deck.selectedCardIndex=e,b({...x,card:x.cards[e]})}function T(){const{cards:e,mode:s}=x,t=!e.length;!t||"learn"!==s&&"review"!==s||(x.deck.cards=x.deck.cards.map((e=>(delete e.frozen,e))),(0,r.C2)(x.deck)),b({...x,wasLastCard:t,card:t?null:N(e)})}function R(){"learn"===x.mode||"review"===x.mode?b({...x,exitModalVisible:!0}):"preview"===x.mode?t("edit"===x.deck.type?`/decks/${x.deck.id}/${x.deck.type}`:"/decks/create",{state:x.deck}):t("/decks")}function $(e){e&&(0,r.C2)(x.deck),t("/decks")}return(0,n.useEffect)((()=>{"1"===new URLSearchParams(s.search).get("reload")?(t({pathname:s.pathname,search:""},{replace:!0,state:{reloaded:!0}}),k()):s.state?.reloaded||k()}),[s.pathname+s.search]),x?x.error||x.message?(0,u.jsx)(l.Z,{message:x.message}):(0,u.jsxs)(u.Fragment,{children:[x.wasLastCard?(0,u.jsx)("div",{className:"study-header",children:(0,u.jsx)("h1",{className:"study-header-title",children:x.deck.title})}):(0,u.jsxs)("div",{className:"study-header"+(x.settings.timeoutDuration.value>0?" has-timer":""),children:[(0,u.jsx)("button",{className:"btn btn-icon study-exit-btn",onClick:R,title:"Exit",children:(0,u.jsx)(d.Z,{name:"close"})}),(0,u.jsx)("h1",{className:"study-header-title",children:x.deck.title}),"preview"===x.mode?(0,u.jsx)(d.Z,{name:"preview",className:"study-preview-icon",title:"In preview mode"}):!x.card.finished&&x.settings.timeoutDuration.value>0&&(0,u.jsx)(f,{revealed:x.card.revealed,initDuration:x.settings.timeoutDuration.value,callback:C})]}),x.wasLastCard?(0,u.jsx)(y,{score:x.score,deck:x.deck,startTime:x.sessionStartedAt,ids:x.sessionCardIds}):(0,u.jsxs)("div",{className:"container max-width-limit",children:[(0,u.jsx)(h,{score:x.score}),"preview"===x.mode&&(0,u.jsx)("ul",{className:"study-card-select",children:x.cards.map(((e,s)=>(0,u.jsx)("li",{className:"study-card-select-item",children:(0,u.jsx)("button",{className:"btn btn-text study-card-select-btn"+(s===x.deck.selectedCardIndex?" active":""),onClick:()=>function(e){const s=x.cards[e];x.deck.selectedCardIndex=e,b({...x,card:s})}(s),children:s+1})},s)))}),(0,u.jsx)(p,{card:x.card,settings:x.settings,selectOption:function(e){x.card.revealed||I(e===x.card.back.typeOptions.correctId)},revealAnswer:function(){const e={...x.card};e.revealed=!0,b({...x,card:e})},skipNextStepTimeout:function(){clearTimeout(j.current),"preview"===x.mode?O():T()},nextStep:I}),x.card.notes?.value&&(0,u.jsx)(v,{notes:x.card.notes})]}),(0,u.jsx)("div",{className:"study-progress",style:{transform:`scaleX(${(x.cardCount-x.cards.length)/x.cardCount})`}}),x.exitModalVisible&&(0,u.jsxs)(o.Z,{hide:function(){b({...x,exitModalVisible:!1})},children:[(0,u.jsx)("h3",{className:"modal-title",children:"Do you want to save your progress?"}),(0,u.jsxs)("div",{className:"study-exit-modal-btns",children:[(0,u.jsx)("button",{className:"btn btn-text study-exit-modal-btn",onClick:()=>$(!0),children:"Save and Exit"}),(0,u.jsx)("button",{className:"btn btn-text study-exit-modal-btn",onClick:()=>$(!1),children:"Exit Without Saving"})]})]})]}):null}},446:(e,s,t)=>{t.d(s,{$P:()=>i,C2:()=>r,GT:()=>a,VC:()=>c});const n=new(t(520).ZP)("nimus-cards");function a(){return n.decks.toArray().then(d).catch((e=>{console.log(e)}))}function c(e){return n.decks.get(e)}function r(e){n.decks.put(e).catch((e=>{console.log(e)}))}function i(e){n.decks.delete(e).catch((e=>{console.log(e)}))}function d(e){return e.sort(((e,s)=>e.createdAt<s.createdAt?1:e.createdAt>s.createdAt?-1:0))}n.version(1).stores({decks:"id"})},255:(e,s,t)=>{t.d(s,{T:()=>a,z:()=>c});let n={textSize:{value:1},randomize:{value:!0},cardCount:{value:10},timeoutDuration:{value:""},...JSON.parse(localStorage.getItem("nimus-cards-settings"))};function a(){return structuredClone(n)}function c(e){n={...n,...e},localStorage.setItem("nimus-cards-settings",JSON.stringify(n))}}}]);