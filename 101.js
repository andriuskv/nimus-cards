"use strict";(globalThis.webpackChunknimus_cards=globalThis.webpackChunknimus_cards||[]).push([[101],{997:(e,t,s)=>{s.d(t,{Z:()=>c});var n=s(294),a=s(893);const c=function({className:e,hide:t,children:s}){const c=(0,n.useCallback)((function({key:e}){"Escape"===e&&t()}),[]);return(0,n.useEffect)((()=>(window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)})),[]),(0,a.jsx)("div",{className:"modal-mask",onClick:function({target:e,currentTarget:s}){e===s&&t()},children:(0,a.jsx)("div",{className:"modal"+(e?` ${e}`:""),children:s})})}},101:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var n=s(294),a=s(974),c=s(620),r=s(446),i=s(255),d=s(461),o=s(997),l=s(291),u=s(893);function m({score:e,name:t,className:s}){const n={"--width":(e.total?e[t]/e.total*100:50)+"%"};return(0,u.jsx)("div",{className:`score-bar score-${t}-bar${s?` ${s}`:""}`,style:n,children:e[t]})}function h({score:e}){return(0,u.jsxs)("div",{className:"study-score",children:[(0,u.jsxs)("div",{className:"study-score-bar-name-container",children:[(0,u.jsx)("span",{children:"Wrong"}),(0,u.jsx)("span",{children:"Right"})]}),(0,u.jsxs)("div",{className:"study-score-bar-container",children:[(0,u.jsx)(m,{score:e,name:"wrong"}),(0,u.jsx)(m,{score:e,name:"right"})]})]})}var x=s(711);function y({score:e,deck:t,startTime:s,ids:n}){const a=!!(0,c.OZ)(t.cards).length,r=!!(0,c.Vb)(t.cards).length,i=t.cards.filter((e=>n.some((t=>e.id===t))));return(0,u.jsxs)("div",{className:"container max-width-limit",children:[(0,u.jsxs)("div",{className:"study-score-container",children:[(0,u.jsx)("h3",{className:"study-score-title",children:"Session Results"}),(0,u.jsxs)("div",{className:"study-score-stats",children:[(0,u.jsx)("span",{className:"study-score-accuracy-name",children:"Accuracy"}),(0,u.jsxs)("span",{className:"study-score-accuracy-value",children:[Math.round(e.right/e.total*100),"%"]}),(0,u.jsxs)("div",{className:"study-score-time",children:[(0,u.jsx)(d.Z,{name:"clock"}),(0,u.jsx)("span",{className:"study-score-time-value",children:(0,c.mr)(Math.floor((Date.now()-s)/1e3))})]})]}),(0,u.jsxs)("div",{className:"study-score-bars",children:[(0,u.jsx)(m,{score:e,name:"wrong"}),(0,u.jsx)(m,{score:e,name:"right"})]}),(0,u.jsxs)("div",{className:"study-score-btn-container",children:[a?(0,u.jsx)(x.rU,{to:{pathname:`/decks/${t.id}/learn`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Learn"}):(0,u.jsx)("span",{className:"btn btn-text study-score-btn disabled",children:"Learn"}),r?(0,u.jsx)(x.rU,{to:{pathname:`/decks/${t.id}/review`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Review"}):(0,u.jsx)("span",{className:"btn btn-text study-score-btn disabled",children:"Review"}),(0,u.jsx)(x.rU,{to:{pathname:`/decks/${t.id}/practice`,search:"?reload=1"},className:"btn btn-text study-score-btn",children:"Practice"}),(0,u.jsx)(x.rU,{to:"/decks",className:"btn btn-text study-score-btn",children:"Close"})]})]}),(0,u.jsxs)("ul",{className:"study-session-stats",children:[(0,u.jsxs)("li",{className:"study-session-stats-item",children:[(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item",children:"Front"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-back-column",children:"Back"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-accuracy-column",children:"Accuracy"}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-header-item study-session-stats-streak-column",children:"Streak"})]}),i.map(((e,t)=>{return(0,u.jsxs)("li",{className:"study-session-stats-item",children:[(0,u.jsx)("div",{className:"study-session-stats-column",children:e.front.attachment?.description||e.front.text}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-back-column",children:(s=e.back,"text"===s.type||"exact"===s.type?s.typeOptions.value:"multi"===s.type?s.typeOptions.options.find((({id:e})=>s.typeOptions.correctId===e)).value:void 0)}),(0,u.jsxs)("div",{className:"study-session-stats-column study-session-stats-accuracy-column",children:[(0,u.jsx)(m,{score:e.score,className:"small",name:"wrong"}),(0,u.jsx)(m,{score:e.score,className:"small",name:"right"})]}),(0,u.jsx)("div",{className:"study-session-stats-column study-session-stats-streak-column",children:e.score.streak})]},t);var s}))]})]})}function v({notes:e}){const[t,s]=(0,n.useState)(!1);return(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"study-notes-toggle-btn-container",children:(0,u.jsx)("button",{className:"btn btn-text",onClick:function(){s(!t)},children:"Notes"})}),t&&(0,u.jsx)("div",{className:"study-notes",children:e.value})]})}const b=function({id:e,attachmentId:t,side:s}){const[a,c]=(0,n.useState)(null),[r,i]=(0,n.useState)(!1),o=(0,n.useRef)(null),l=(0,n.useRef)(null);function m(){o.current.currentTime=0,o.current.play()}function h(){l.current.currentTime=0,l.current.play()}function x(){const{mediaType:e,src:t,attachmentId:s}=a;return"image"===e?(0,u.jsx)("button",{className:"btn btn-icon study-attachment-btn study-image-btn",onClick:y,children:(0,u.jsx)("img",{src:t,alt:"",className:"study-image"})}):"audio"===e?(0,u.jsxs)("button",{className:"btn study-attachment-btn study-audio-btn",onClick:m,children:[(0,u.jsx)(d.Z,{name:"volume",className:"study-audio-btn-icon"}),(0,u.jsx)("audio",{src:t,ref:o,autoPlay:!0},s)]}):"video"===e?(0,u.jsx)("button",{className:"btn btn-icon study-attachment-btn study-video-btn",onClick:h,children:(0,u.jsx)("video",{src:t,className:"study-video",crossOrigin:"anonymous",ref:l,autoPlay:!0},s)}):null}function y(){i(!r)}function v(){return(0,u.jsx)("div",{className:"study-front-text",children:s.text})}return(0,n.useEffect)((()=>{let e="",n="";if(s.attachment){const{blob:a,url:r,type:i}=s.attachment;n=a?"blob":"url",e=a?URL.createObjectURL(a):r,c({src:e,attachmentId:t,mediaType:i})}else c(null);return()=>{"blob"===n&&URL.revokeObjectURL(e)}}),[e,t]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"study-front-content",children:s.text&&a?(0,u.jsxs)(u.Fragment,{children:[x(),v()]}):s.text?v():a?x():null}),r&&(0,u.jsx)("div",{className:"study-expanded-image-mask",onClick:function(){i(!1)},children:(0,u.jsx)("img",{src:a.src,className:"study-expanded-image",alt:""})})]})};const p=function({card:e,selectOption:t,handleSubmit:s}){const{back:n,revealed:a}=e,{type:r,typeOptions:i}=n;return"text"===r?(0,u.jsx)("div",{className:"study-card-text-content",children:i.value}):"exact"===r?function(){let t="input study-exact-input";return a&&(t+=e.isCorrect?" right":" wrong"),(0,u.jsxs)("form",{onSubmit:s,className:"study-exact",children:[(0,u.jsxs)("label",{children:[(0,u.jsxs)("div",{className:"study-exact-top",children:[(0,u.jsx)("div",{className:"study-exact-title",children:"Your Answer:"}),n.typeOptions.caseSensitive?(0,u.jsxs)("div",{className:"study-exact-notice",children:[(0,u.jsx)(d.Z,{name:"info",className:"study-exact-notice-icon"}),(0,u.jsx)("span",{children:"Answer is case sensitive"})]}):""]}),(0,u.jsx)("input",{type:"input",className:t,name:"answer",disabled:a})]}),(0,u.jsx)("button",{className:"btn study-exact-btn",disabled:a,children:"Check Answer"})]})}():"multi"===r?(0,u.jsx)("ul",{className:(0,c.AK)("study-multi",`study-multi-${n.typeOptions.layout}-type`,a?"revealed":""),children:i.options.map((({id:e,value:s},r)=>(0,u.jsx)("li",{children:(0,u.jsx)("button",{onClick:()=>t(e),className:(0,c.AK)("btn study-multi-item",`study-multi-${n.typeOptions.layout}-type-item`,a&&i.correctId===e?"correct":""),children:s})},e+r)))}):null};const j=function({card:e,settings:t,selectOption:s,revealAnswer:n,nextStep:a,skipNextStepTimeout:c}){return(0,u.jsxs)("div",{className:"study-card",style:{"--text-base-size":`${t.textSize.value}rem`},children:[(0,u.jsx)(b,{id:e.id,attachmentId:e.attachmentId,side:e.front}),"text"!==e.back.type||e.revealed?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(p,{card:e,selectOption:s,handleSubmit:function(t){if(t.preventDefault(),t.persist(),e.revealed)return;const s=t.target.elements.answer.value;let n=!1;n=e.back.typeOptions.caseSensitive?s===e.back.typeOptions.value:s.toLowerCase()===e.back.typeOptions.value.toLowerCase(),a(n),setTimeout((()=>{t.target.reset()}),1600)}}),"text"===e.back.type&&e.revealed&&(e.finished||e.timerReveal?(0,u.jsx)("button",{className:"btn btn-invert study-card-text-btn",onClick:c,children:"Next"}):(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{className:"btn btn-negative study-card-text-btn",disabled:e.finished,onClick:()=>a(!1),children:"I Was Wrong"}),(0,u.jsx)("button",{className:"btn btn-positive study-card-text-btn",disabled:e.finished,onClick:()=>a(!0),children:"I Got It Right"})]}))]}):(0,u.jsx)("button",{className:"btn btn-invert study-card-text-btn",onClick:n,children:"Check"})]})};const f=function({revealed:e,initDuration:t,callback:s}){const[a,r]=(0,n.useState)(t),i=(0,n.useRef)(0);function d(e){e<1?s():i.current=setTimeout((()=>{const t=e-1;r(t),d(t)}),1e3)}return(0,n.useEffect)((()=>(d(a),()=>{clearTimeout(i.current)})),[]),(0,n.useEffect)((()=>{e&&clearTimeout(i.current)}),[e]),(0,u.jsx)("div",{className:"timer",children:(0,c.mr)(a)})};const k=function({mode:e}){const t=(0,a.TH)(),s=(0,a.s0)(),m=(0,a.UO)(),[x,b]=(0,n.useState)(null),p=(0,n.useRef)(0);function k(){"preview"!==e?(0,r.VC)(m.id).then((e=>{e?g(e):b({error:!0})})):t.state?.title?g(t.state):b({error:!0})}function g(t){let{cards:s}=t;if("learn"===e){if(s=(0,c.OZ)(s),!s.length)return void b({message:"You learned all available cards, come back later for a review."})}else if("review"===e&&(s=(0,c.Vb)(s),!s.length))return void b({message:"You have nothing to review at this moment, come back later."});const n=function(e,t){const s=(0,i.T)();return"preview"===t?{...s,randomize:{value:!1},cardCount:{value:0}}:!e.settings||e.settings.useGlobalSettings.value?s:{...e.settings,textSize:s.textSize}}(t,e);s=n.randomize.value?(0,c.Sy)(s):s;const a=s.slice(0,n.cardCount.value||s.length).map((e=>(e.score=e.score||{streak:0,right:0,wrong:0,total:0},e))),r="preview"===e?s[t.selectedCardIndex]:N(a);b({mode:e,deck:t,settings:n,sessionStartedAt:Date.now(),cardCount:a.length,cards:a,card:r,score:{right:0,wrong:0,total:0}}),(0,c.Dk)(t.title)}function N(e){const[t]=e;return"multi"===t.back.type&&(t.back.typeOptions.options=(0,c.Sy)(t.back.typeOptions.options)),{...t}}function w(e){const{score:t}=x;return e?t.right+=1:t.wrong+=1,t.total=t.right+t.wrong,t}function C(){O(!1,{timerReveal:!0})}function S(e,t){const s=x.deck.cards.find((t=>t.id===e));s.frozen||(function(e,t){const s=e.level||0;let n=s;t?n=s<8?s+1:8:(e.frozen=!0,n=1);const a=6*Math.pow(2,n-1)*n;e.level=n,e.nextReview=Date.now()+60*a*60*1e3}(s,t),function(e,t){t?(e.score.streak+=1,e.score.right+=1):(e.frozen=!0,e.score.streak=0,e.score.wrong+=1),e.score.total=e.score.right+e.score.wrong}(s,t))}function O(e,t={}){const s="preview"===x.mode?x.cards[x.deck.selectedCardIndex]:x.cards.shift(),n={...s,...t,isCorrect:e,revealed:!0,finished:!0};"learn"!==x.mode&&"review"!==x.mode||S(s.id,e),e?x.sessionCardIds=[...x.sessionCardIds||[],s.id]:"preview"!==x.mode&&(s.attachmentId=(0,c.zO)(),x.cards.push(s),x.cards=x.settings.randomize.value?(0,c.Sy)(x.cards):x.cards),b({...x,card:n,score:w(e)}),p.current=setTimeout("preview"===x.mode?I:T,1600)}function I(){const e=(x.deck.selectedCardIndex+1)%x.cards.length;x.deck.selectedCardIndex=e,b({...x,card:x.cards[e]})}function T(){const{cards:e,mode:t}=x,s=!e.length;!s||"learn"!==t&&"review"!==t||(x.deck.cards=x.deck.cards.map((e=>(delete e.frozen,e))),(0,r.C2)(x.deck)),b({...x,wasLastCard:s,card:s?null:N(e)})}function R(){"learn"===x.mode||"review"===x.mode?b({...x,exitModalVisible:!0}):"preview"===x.mode?s("edit"===x.deck.type?`/decks/${x.deck.id}/${x.deck.type}`:"/decks/create",{state:x.deck}):s("/decks")}function A(e){e&&(0,r.C2)(x.deck),s("/decks")}return(0,n.useEffect)((()=>{"1"===new URLSearchParams(t.search).get("reload")?(s({pathname:t.pathname,search:""},{replace:!0,state:{reloaded:!0}}),k()):t.state?.reloaded||k()}),[t.pathname+t.search]),x?x.error||x.message?(0,u.jsx)(l.Z,{message:x.message}):(0,u.jsxs)(u.Fragment,{children:[x.wasLastCard?(0,u.jsx)("div",{className:"study-header",children:(0,u.jsx)("h1",{className:"study-header-title",children:x.deck.title})}):(0,u.jsxs)("div",{className:"study-header"+(x.settings.timeoutDuration.value>0?" has-timer":""),children:[(0,u.jsx)("button",{className:"btn btn-icon study-exit-btn",onClick:R,title:"Exit",children:(0,u.jsx)(d.Z,{name:"close"})}),(0,u.jsx)("h1",{className:"study-header-title",children:x.deck.title}),"preview"===x.mode&&(0,u.jsx)(d.Z,{name:"preview",className:"study-preview-icon",title:"In preview mode"}),!x.card.finished&&x.settings.timeoutDuration.value>0&&(0,u.jsx)(f,{revealed:x.card.revealed,initDuration:x.settings.timeoutDuration.value,callback:C})]}),x.wasLastCard?(0,u.jsx)(y,{score:x.score,deck:x.deck,startTime:x.sessionStartedAt,ids:x.sessionCardIds}):(0,u.jsxs)("div",{className:"container max-width-limit",children:[(0,u.jsx)(h,{score:x.score}),"preview"===x.mode&&(0,u.jsx)("ul",{className:"study-card-select",children:x.cards.map(((e,t)=>(0,u.jsx)("li",{className:"study-card-select-item",children:(0,u.jsx)("button",{className:"btn btn-text study-card-select-btn"+(t===x.deck.selectedCardIndex?" active":""),onClick:()=>function(e){const t=x.cards[e];x.deck.selectedCardIndex=e,b({...x,card:t})}(t),children:t+1})},t)))}),(0,u.jsx)(j,{card:x.card,settings:x.settings,selectOption:function(e){x.card.revealed||O(e===x.card.back.typeOptions.correctId)},revealAnswer:function(){const e={...x.card};e.revealed=!0,b({...x,card:e})},skipNextStepTimeout:function(){clearTimeout(p.current),"preview"===x.mode?I():T()},nextStep:O}),x.card.notes?.value&&(0,u.jsx)(v,{notes:x.card.notes})]}),(0,u.jsx)("div",{className:"study-progress",style:{transform:`scaleX(${(x.cardCount-x.cards.length)/x.cardCount})`}}),x.exitModalVisible&&(0,u.jsxs)(o.Z,{hide:function(){b({...x,exitModalVisible:!1})},children:[(0,u.jsx)("h3",{className:"modal-title",children:"Do you want to save your progress?"}),(0,u.jsxs)("div",{className:"study-exit-modal-btns",children:[(0,u.jsx)("button",{className:"btn btn-text study-exit-modal-btn",onClick:()=>A(!0),children:"Save and Exit"}),(0,u.jsx)("button",{className:"btn btn-text study-exit-modal-btn",onClick:()=>A(!1),children:"Exit Without Saving"})]})]})]}):null}},446:(e,t,s)=>{s.d(t,{GT:()=>a,VC:()=>c,C2:()=>r,$P:()=>i});const n=new(s(134).Z)("nimus-cards");function a(){return n.decks.toArray().then(d).catch((e=>{console.log(e)}))}function c(e){return n.decks.get(e)}function r(e){n.decks.put(e).catch((e=>{console.log(e)}))}function i(e){n.decks.delete(e).catch((e=>{console.log(e)}))}function d(e){return e.sort(((e,t)=>e.createdAt<t.createdAt?1:e.createdAt>t.createdAt?-1:0))}n.version(1).stores({decks:"id"})},255:(e,t,s)=>{s.d(t,{T:()=>r,z:()=>i});var n=s(465),a=s.n(n);let c={textSize:{value:1},randomize:{value:!0},cardCount:{value:10},timeoutDuration:{value:""},...JSON.parse(localStorage.getItem("nimus-cards-settings"))};function r(){return a()(c)}function i(e){c={...c,...e},localStorage.setItem("nimus-cards-settings",JSON.stringify(c))}}}]);