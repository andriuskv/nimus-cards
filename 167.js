"use strict";(globalThis.webpackChunknimus_cards=globalThis.webpackChunknimus_cards||[]).push([[167],{167:(e,t,a)=>{a.r(t),a.d(t,{default:()=>j});var s=a(294),n=a(974),c=a(465),i=a.n(c),l=a(620),r=a(446),o=a(547),d=a(461),u=a(291),m=a(893);const p=function({addAttachment:e,errorMessage:t}){const[a,n]=(0,s.useState)(""),[c,i]=(0,s.useState)("image");function l(e){n(e),setTimeout((()=>{n("")}),3200)}function r(){l(`URL does not contain valid ${c} file.`)}return(0,m.jsxs)("div",{className:"upload-panel",children:[(0,m.jsx)("div",{className:"upload-type-selection",children:["image","audio","video"].map(((e,t)=>(0,m.jsxs)("button",{className:"btn btn-icon-text upload-type-selection-btn"+(c===e?" active":""),onClick:()=>i(e),children:[(0,m.jsx)(d.Z,{name:`${e}-file`}),(0,m.jsx)("span",{children:e})]},t)))}),(0,m.jsxs)("div",{className:"upload-panel-content",children:[(0,m.jsxs)("label",{className:"btn upload-panel-import-input-container",children:[(0,m.jsx)("span",{children:"Select File"}),(0,m.jsx)("input",{type:"file",className:"sr-only",onChange:function({target:t}){const[a]=t.files;t.value="",a.type.split("/")[0]!==c?l(`Selected file is not ${"v"===c[0]?"a":"an"} ${c} file.`):e({blob:a,type:c})}})]}),(0,m.jsx)("div",{className:"upload-panel-item-separator",children:"OR"}),a&&(0,m.jsx)("div",{className:"upload-panel-message",children:a}),(0,m.jsxs)("form",{onSubmit:function(t){const a=t.target.elements.url.value.trim();if(t.preventDefault(),a){if("image"===c){const t=new Image;t.onload=()=>{e({url:a,type:c})},t.onerror=e=>{r(),console.log(e)},t.src=a}else if("audio"===c){const t=new Audio(a);t.onloadedmetadata=()=>{e({url:a,type:c})},t.onerror=e=>{r(),console.log(e)}}else if("video"===c){const t=document.createElement("video");t.crossOrigin="anonymous",t.onloadedmetadata=()=>{e({url:a,type:c})},t.onerror=e=>{r(),console.log(e)},t.src=a}}else l("Please specify valid url.")},className:"upload-panel-form",children:[(0,m.jsx)("input",{type:"text",name:"url",className:"input upload-panel-form-input",placeholder:"Enter URL..."}),(0,m.jsx)("button",{className:"btn upload-panel-form-btn",children:"Upload"})]})]}),t&&(0,m.jsx)("div",{className:"create-side-message",children:t})]})},x=(0,s.memo)((({attachment:e})=>{const{blob:t,url:a,type:s}=e,n=t?URL.createObjectURL(t):a;return"image"===s?(0,m.jsx)("img",{src:n,alt:"",className:"create-side-image"}):"audio"===s?(0,m.jsx)("audio",{src:n,className:"create-side-audio",controls:!0}):"video"===s?(0,m.jsx)("video",{src:n,className:"create-side-video",crossOrigin:"anonymous",controls:!0}):null}));const h=function({side:e,addAttachment:t,removeAttachment:a,updateAttachmentDescription:n,handleChange:c}){const{text:i,attachment:l}=e,[r,o]=(0,s.useState)(!i&&l?"attachment":"text");function u({target:e}){o(e.value)}return(0,m.jsxs)("div",{className:"create-card-side",children:[(0,m.jsx)("div",{className:"create-side-toolbar",children:(0,m.jsxs)("ul",{className:"create-side-types",children:[(0,m.jsx)("li",{className:"create-side-type",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",value:"text",checked:"text"===r,onChange:u}),(0,m.jsx)(d.Z,{name:"text",title:"Text",className:"create-option-type-icon"})]})}),(0,m.jsx)("li",{className:"create-side-type",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",value:"attachment",checked:"attachment"===r,onChange:u}),(0,m.jsx)(d.Z,{name:"attachment",title:"Attachment",className:"create-option-type-icon"})]})})]})}),"text"===r?(0,m.jsxs)("div",{className:"create-side-content create-front-side-content",children:[(0,m.jsx)("textarea",{className:"input create-side-text-input",value:i,onChange:c}),function(){const{error:t}=e;return t?.attachmentMessage?(0,m.jsx)("div",{className:"create-side-message",children:t.attachmentMessage}):t?.textMessage?(0,m.jsx)("div",{className:"create-side-message",children:t.textMessage}):null}()]}):(0,m.jsx)("div",{className:"create-side-content create-front-side-content",children:l?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"create-side-panel",children:[(0,m.jsx)("button",{type:"button",className:"btn btn-icon create-side-panel-btn",onClick:a,title:"Remove attachment",children:(0,m.jsx)(d.Z,{name:"remove"})}),(0,m.jsx)(x,{attachment:l}),e.error?.attachmentMessage&&(0,m.jsx)("div",{className:"create-side-attachment-message",children:e.error.attachmentMessage})]}),(0,m.jsx)("input",{type:"text",className:"input create-side-attachment-input",placeholder:"Describe attachment",defaultValue:l.description,onChange:n})]}):(0,m.jsx)(p,{addAttachment:t,errorMessage:e.error?.textMessage})})]})};const v=function({side:e,updateCardBack:t}){const{type:a,textOptions:s,multiOptions:n,exactOptions:c}=e;function i({target:e}){n.layout=e.value,t({multiOptions:n})}function r({target:e}){const{name:a,value:s}=e,c=n.options[a];s!==c.value&&(c.value=s,t({multiOptions:n}))}function o({target:e}){const{name:a,value:s,checked:n}=e;"caseSensitive"===a?c.caseSensitive=n:c.value=s,t({exactOptions:c})}function u(){return(0,m.jsx)("textarea",{className:"input create-side-text-input",value:s.value,onChange:a=>function({target:a}){const{value:n}=a;n!==e.value&&(s.value=n,t({textOptions:s}))}(a)})}function p(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"create-multi-layout",children:[(0,m.jsx)("div",{className:"create-multi-layout-title",children:"Layout"}),(0,m.jsxs)("div",{onInput:i,className:"create-multi-layout-items",children:[(0,m.jsxs)("label",{className:"create-multi-layout-item",children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"short",defaultChecked:"short"===n.layout}),(0,m.jsx)(d.Z,{name:"grid",className:"create-option-type-icon"})]}),(0,m.jsxs)("label",{className:"create-multi-layout-item",children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"medium",defaultChecked:"medium"===n.layout}),(0,m.jsx)(d.Z,{name:"list-2-col",className:"create-option-type-icon"})]}),(0,m.jsxs)("label",{className:"create-multi-layout-item",children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"long",defaultChecked:"long"===n.layout}),(0,m.jsx)(d.Z,{name:"menu",className:"create-option-type-icon"})]})]})]}),(0,m.jsx)("ul",{children:n.options.map((({id:e,value:a},s)=>(0,m.jsxs)("li",{className:"create-option",children:[(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only radio-input",name:"multi-option",checked:n.correctId===e,onChange:()=>function(e){n.correctId=e,t({multiOptions:n})}(e)}),(0,m.jsx)("div",{className:"radio",title:"Mark answer as correct"})]}),(0,m.jsx)("input",{type:"text",className:"input create-option-input",name:s,defaultValue:a,autoComplete:"off",onChange:r}),(0,m.jsx)("button",{className:"btn btn-icon",title:"Remove answer",onClick:()=>{return e=s,n.options.splice(e,1),void t({multiOptions:n});var e},children:(0,m.jsx)(d.Z,{name:"remove"})})]},e)))})]})}return(0,m.jsxs)("div",{className:"create-card-side",children:[(0,m.jsxs)("div",{className:"create-side-toolbar",children:[(0,m.jsxs)("ul",{className:"create-side-types",onChange:function({target:e}){t({type:e.value})},children:[(0,m.jsx)("li",{className:"create-side-type",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"text",defaultChecked:"text"===a}),(0,m.jsx)(d.Z,{name:"text",title:"Text",className:"create-option-type-icon"})]})}),(0,m.jsx)("li",{className:"create-side-type",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"multi",defaultChecked:"multi"===a}),(0,m.jsx)(d.Z,{name:"list-checkbox",title:"Multiple choice",className:"create-option-type-icon"})]})}),(0,m.jsx)("li",{className:"create-side-type",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"exact",defaultChecked:"exact"===a}),(0,m.jsx)(d.Z,{name:"text-short",title:"Exact answer",className:"create-option-type-icon"})]})})]}),"multi"===a&&(0,m.jsx)("button",{className:"btn btn-icon",onClick:function(){n.options.length<8&&(n.options.push({id:(0,l.zO)()}),t({multiOptions:n}))},title:"Add option",disabled:n.options.length>=8,children:(0,m.jsx)(d.Z,{name:"add-list-item"})})]}),(0,m.jsxs)("div",{className:"create-side-content",children:[function(e){return"text"===e?u():"multi"===e?p():"exact"===e?(0,m.jsxs)("div",{onChange:o,children:[(0,m.jsxs)("label",{className:"create-exact-input-container",children:[(0,m.jsx)("div",{className:"create-exact-input-title",children:"Provide an answer:"}),(0,m.jsx)("input",{type:"text",className:"input create-exact-input",name:"input",autoComplete:"off",defaultValue:c.value})]}),(0,m.jsxs)("label",{className:"checkbox-container create-exact-checkbox-container",children:[(0,m.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",name:"caseSensitive",defaultChecked:c.caseSensitive}),(0,m.jsx)("div",{className:"checkbox",children:(0,m.jsx)("div",{className:"checkbox-tick"})}),(0,m.jsx)("span",{className:"checkbox-label",children:"Case sensitive"})]})]}):null}(a),e.error?.message&&(0,m.jsx)("div",{className:"create-side-message",children:e.error.message})]})]})};function f({value:e,handleChange:t}){return(0,m.jsx)("div",{className:"create-card-notes-container",children:(0,m.jsx)("textarea",{className:"input create-card-notes-input",placeholder:"Notes...",value:e,onChange:e=>t(e,"notes","value")})})}const j=function(){const e=(0,n.TH)(),t=(0,n.s0)(),a=(0,n.UO)(),[c,p]=(0,s.useState)(null),[x,j]=(0,s.useState)([]);let b=0;function g(){return{id:(0,l.zO)(),front:{text:""},back:{type:"text",textOptions:{value:""},multiOptions:{correctId:"",layout:"short",options:[{id:(0,l.zO)()},{id:(0,l.zO)()}]},exactOptions:{caseSensitive:!1,value:""}},notes:{value:""},score:{streak:0,right:0,wrong:0,total:0}}}function N(e){return e.map((e=>{const{back:t}=g();return e.back={...t,...e.back,[`${e.back.type}Options`]:e.back.typeOptions},delete e.back.typeOptions,e}))}function y(e,t){const a=e+t,s=c.cards;[s[e],s[a]]=[s[a],s[e]],p({...c})}function k({target:e}){const{name:t,value:a}=e;c[t]=a,"title"===t&&c.missingTitle&&delete c.missingTitle,p({...c})}function C(e){return e.attachment?!!e.attachment.description:!!e.text}function O(e){return{validOptionCount:e.options.reduce(((e,{value:t})=>(t&&(e+=1),e)),0),correctId:e.correctId}}function w(e){if("text"===e.type)return e.textOptions.value.length>0;if("exact"===e.type)return e.exactOptions.value.length>0;const{validOptionCount:t,correctId:a}=O(e.multiOptions);return t>1&&a}function I(e){c.title||(c.missingTitle=!0);const a=function(e){let t=0;for(const a of e){let e=0;if(a.valid=!1,a.invalid=!1,C(a.front))e+=1,delete a.front.error;else{a.front.error=a.front.error||{};const{text:e,attachment:t,error:s}=a.front;t&&!t.description?s.attachmentMessage="Please provide attachment description.":e||(s.textMessage="Please fill in the text field or provide an attachment.")}if(w(a.back))e+=1,delete a.back.error;else{a.back.error=a.back.error||{};const{type:e,textOptions:t,exactOptions:s,multiOptions:n,error:c}=a.back;if("text"!==e||t.value)if("exact"!==e||s.value){if("multi"===e){const{validOptionCount:e,correctId:t}=O(n);e<2?c.message="Please fill in at least 2 options.":t||(c.message="Please select correct option.")}}else c.message="Please provide an answer.";else c.message="Please fill in the text field."}2===e?(t+=1,a.valid=!0):a.invalid=!0}return c.globalMessage=t<2?"Please fill in at least 2 cards.":"",t===e.length}(c.cards);if(c.title&&a)if(c.cards=c.cards.map((e=>{const t={type:e.back.type,typeOptions:e.back[`${e.back.type}Options`]};return e.modified&&(delete e.score,delete e.level,delete e.nextReview),delete e.modified,delete e.invalid,delete e.valid,"multi"===t.type&&(t.typeOptions.options=e.back.multiOptions.options.filter((({value:e})=>e))),e.back=t,e})),"preview"===e)t(`/decks/${c.id}/preview`,{state:c});else{const e=Date.now();delete c.type,delete c.selectedCardIndex,c.createdAt?c.modifiedAt=e:c.createdAt=e,t("/decks"),(0,r.C2)(c)}else p({...c})}if((0,s.useEffect)((()=>{if(e.state){const t=e.state;t.cards=N(t.cards),p(t),(0,l.Dk)("edit"===t.type?`Editing ${t.title}`:"Create a new deck")}else"/decks/create"===e.pathname?(p({id:(0,l.zO)(),type:"create",title:"",description:"",selectedCardIndex:0,cards:[g(),g()]}),(0,l.Dk)("Create a new deck")):a.id&&(0,r.VC)(a.id).then((e=>{e?(e.type="edit",e.makingEdit=!0,e.selectedCardIndex=0,e.cards=N(e.cards),p(e),(0,l.Dk)(`Editing ${e.title}`)):p({error:!0})}))}),[]),(0,s.useEffect)((()=>(clearTimeout(b),x.length>0&&(b=setTimeout((()=>{j([])}),8e3)),()=>{clearTimeout(b)})),[x.length]),!c)return null;if(c.error)return(0,m.jsx)(u.Z,{});const A=c.selectedCardIndex,Z=c.cards.length,M=c.cards[A];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.Z,{}),(0,m.jsxs)("div",{className:"container max-width-limit",children:[(0,m.jsxs)("label",{className:"create-field",children:[(0,m.jsx)("div",{className:"create-field-title",children:"Title"}),(0,m.jsx)("input",{className:"input create-field-input",name:"title",value:c.title,onChange:k}),c.missingTitle&&(0,m.jsx)("div",{className:"create-field-input-message",children:"Please provide title for your deck."})]}),(0,m.jsxs)("label",{className:"create-field",children:[(0,m.jsx)("div",{className:"create-field-title",children:"Description"}),(0,m.jsx)("input",{className:"input create-field-input",name:"description",value:c.description,onChange:k})]}),(0,m.jsxs)("ul",{className:"create-card-select",children:[c.cards.map(((e,t)=>(0,m.jsx)("li",{className:"create-card-select-item",children:(0,m.jsx)("button",{className:`btn btn-text create-card-select-btn${t===c.selectedCardIndex?" active":""}${e.invalid?" invalid":""}${e.valid?" valid":""}`,onClick:()=>function(e){e!==c.selectedCardIndex&&p({...c,selectedCardIndex:e})}(t),children:t+1})},t))),(0,m.jsx)("li",{className:"create-card-select-item",children:(0,m.jsx)("button",{onClick:function(){const e=c.cards[c.cards.length-1],t=g();t.back.type=e.back.type,"multi"===t.back.type?t.back.multiOptions.layout=e.back.multiOptions.layout:"exact"===t.back.type&&(t.back.exactOptions.caseSensitive=e.back.exactOptions.caseSensitive),p({...c,cards:[...c.cards,t]})},className:"btn btn-icon create-card-select-btn",title:"Add Card",children:(0,m.jsx)(d.Z,{name:"plus"})})})]}),(0,m.jsxs)("div",{className:"create-card",children:[(0,m.jsxs)("div",{className:"create-card-header",children:[(0,m.jsxs)("div",{className:"create-card-index-container",children:[(0,m.jsx)("button",{className:"btn btn-icon create-card-header-item",onClick:()=>y(A,-1),title:"Swap with the left card",disabled:0===A,children:(0,m.jsx)(d.Z,{name:"chevron-left"})}),(0,m.jsx)("div",{className:"create-card-index",children:A+1}),(0,m.jsx)("button",{className:"btn btn-icon create-card-header-item",onClick:()=>y(A,1),title:"Swap with the right card",disabled:A===Z-1,children:(0,m.jsx)(d.Z,{name:"chevron-right"})})]}),(0,m.jsx)("button",{className:"btn btn-icon",title:"Clone card",onClick:()=>function(e){const t=i()(c.cards[e]);t.id=(0,l.zO)(),c.selectedCardIndex=e,c.cards.splice(e,0,t),p({...c})}(A),children:(0,m.jsx)(d.Z,{name:"clone"})}),Z>1&&(0,m.jsx)("button",{className:"btn btn-icon create-card-remove-card-btn",title:"Remove card",onClick:()=>function(e){const t=c.cards[e];(C(t.front)||w(t.back)||t.notes.value)&&j([...x,t]),c.selectedCardIndex=e>0?e-1:0,c.cards.splice(e,1),p({...c})}(A),children:(0,m.jsx)(d.Z,{name:"remove"})})]}),(0,m.jsxs)("div",{className:"create-card-main",children:[(0,m.jsx)(h,{side:M.front,addAttachment:function(e){const t=c.cards[c.selectedCardIndex];t.modified=!0,t.front.attachment=e,delete t.front.error,p({...c})},removeAttachment:function(){const e=c.cards[c.selectedCardIndex];e.modified=!0,delete e.front.attachment,delete e.front.error,p({...c})},updateAttachmentDescription:function({target:e}){const t=c.cards[c.selectedCardIndex];t.modified=!0,t.front.attachment.description=e.value,t.front.error?.attachmentMessage&&delete t.front.error,p({...c})},handleChange:function({target:e}){const{value:t}=e,a=c.cards[c.selectedCardIndex];t!==a.front.text&&(a.front.text=t,a.modified=!0,a.front.error?.textMessage&&delete a.front.error.textMessage,p({...c}))}}),(0,m.jsx)(v,{side:M.back,updateCardBack:function(e){const t=c.cards[c.selectedCardIndex];t.modified=!0,t.back={...t.back,...e},delete t.back.error,p({...c})}})]},M.id),(0,m.jsx)(f,{value:M.notes.value,handleChange:function({target:e}){const{value:t}=e,a=c.cards[c.selectedCardIndex];t!==a.notes.value&&(a.notes.value=t,p({...c}))}})]}),x.length>0&&(0,m.jsxs)("div",{className:"create-undo-dialog",children:[(0,m.jsxs)("span",{children:["Removed ",x.length," card",x.length>1?"s":""]}),(0,m.jsx)("button",{className:"btn btn-text create-dialog-undo-btn",onClick:function(){j([]),p({...c,cards:c.cards.concat(x)})},children:"UNDO"})]}),(0,m.jsxs)("div",{className:"create-footer",children:[c.globalMessage&&(0,m.jsx)("span",{className:"create-message",children:c.globalMessage}),(0,m.jsx)("button",{className:"btn create-footer-btn",onClick:function(){I("preview")},children:"Preview"}),(0,m.jsx)("button",{className:"btn create-footer-btn",onClick:I,children:c.makingEdit?"Update":"Create"})]})]})]})}},446:(e,t,a)=>{a.d(t,{GT:()=>n,VC:()=>c,C2:()=>i,$P:()=>l});const s=new(a(134).Z)("nimus-cards");function n(){return s.decks.toArray().then(r).catch((e=>{console.log(e)}))}function c(e){return s.decks.get(e)}function i(e){s.decks.put(e).catch((e=>{console.log(e)}))}function l(e){s.decks.delete(e).catch((e=>{console.log(e)}))}function r(e){return e.sort(((e,t)=>e.createdAt<t.createdAt?1:e.createdAt>t.createdAt?-1:0))}s.version(1).stores({decks:"id"})}}]);